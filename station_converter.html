<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WhatsApp Treinbericht Parser</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f2f5;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Start from top, not center */
            padding: 2rem;
        }
        .container {
            background-color: #ffffff;
            padding: 2.5rem;
            border-radius: 0.75rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 960px; /* Increased max-width */
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        textarea {
            width: 100%;
            border-radius: 0.5rem;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            resize: vertical;
            min-height: 120px;
        }
        button {
            background-color: #1a73e8;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s ease-in-out;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        button:hover {
            background-color: #155bb5;
        }
        .output-section {
            background-color: #e2e8f0;
            border-radius: 0.5rem;
            padding: 1.25rem;
            min-height: 100px;
            white-space: pre-wrap; /* Behoudt enters en spaties */
            word-wrap: break-word; /* Breek lange woorden af */
            border: 1px solid #cbd5e0;
        }
        .config-section {
            background-color: #f8fafc;
            border-radius: 0.5rem;
            padding: 1.25rem;
            border: 1px solid #e2e8f0;
        }
        .config-section h3 {
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #334155;
        }
        .config-section textarea {
            background-color: #ffffff;
            font-family: monospace; /* Monospace font voor JSON */
            font-size: 0.875rem;
            min-height: 100px;
        }
        .highlight-loc, .highlight-train {
            background-color: #facc15; /* Geel */
            padding: 0.1rem 0.3rem;
            border-radius: 0.2rem;
            font-weight: bold;
        }
        .highlight-direction {
            background-color: #93c5fd; /* Lichtblauw */
            padding: 0.1rem 0.3rem;
            border-radius: 0.2rem;
            font-weight: bold;
        }
        .warning {
            color: #ef4444; /* Rood */
            font-size: 0.875rem;
            margin-top: 0.5rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-bold text-center text-gray-800 mb-4">WhatsApp Treinbericht Parser</h1>

        <!-- Input sectie -->
        <div class="input-section">
            <label for="whatsappMessage" class="block text-gray-700 text-lg font-medium mb-2">Plak je WhatsApp bericht hier:</label>
            <textarea id="whatsappMessage" placeholder="Bijv. Loc 186 001 op Asd vertraagd ivm sein 'rood'. Trein 'De IJssel' rijdt richting Ut."></textarea>
            <button onclick="processMessage()" class="mt-4 w-full">Verwerk Bericht</button>
        </div>

        <!-- Output sectie -->
        <div class="output-section-container">
            <h2 class="text-2xl font-bold text-gray-800 mb-2">Verwerkt Resultaat:</h2>
            <div id="output" class="output-section text-gray-800 text-base"></div>
        </div>

        <!-- Configuratie secties -->
        <div class="config-section">
            <h3 class="text-xl">Stationsafkortingen Configuratie (JSON):</h3>
            <textarea id="stationConfig" rows="8">
{
    "HT": "'s-Hertogenbosch",
"HTO": "'s-Hertogenbosch Oost",
"HDE": "'t Harde",
"AHBF": "Aachen Hbf",
"AW": "Aachen West",
"ATN": "Aalten",
"AC": "Abcoude",
"EAHS": "Ahaus",
"AIME": "Aime-la-Plagne",
"ACDG": "Airport Charles de Gaulle",
"AIXTGV": "Aix-en-Provence TGV",
"AKM": "Akkrum",
"ALBERT": "Albertville",
"AMR": "Alkmaar",
"AMRN": "Alkmaar Noord",
"AML": "Almelo",
"AMRI": "Almelo de Riet",
"ALMB": "Almere Buiten",
"ALM": "Almere Centrum",
"ALMM": "Almere Muziekwijk",
"ALMO": "Almere Oostvaarders",
"ALMP": "Almere Parkwijk",
"AMPO": "Almere Poort",
"APN": "Alphen a/d Rijn",
"EABG": "Altenberge",
"AMF": "Amersfoort Centraal",
"AMFS": "Amersfoort Schothorst",
"AVAT": "Amersfoort Vathorst",
"ASA": "Amsterdam Amstel",
"ASB": "Amsterdam Bijlmer ArenA",
"ASD": "Amsterdam Centraal",
"ASHD": "Amsterdam Holendrecht",
"ASDL": "Amsterdam Lelylaan",
"ASDM": "Amsterdam Muiderpoort",
"RAI": "Amsterdam RAI",
"ASSP": "Amsterdam Science Park",
"ASS": "Amsterdam Sloterdijk",
"ASDZ": "Amsterdam Zuid",
"AMST": "Amstetten NÖ",
"ANA": "Anna Paulowna",
"BERCH": "Antwerpen-Berchem",
"ATW": "Antwerpen-Centraal",
"ATWLB": "Antwerpen-Luchtbal",
"ANDD": "Antwerpen-Noorderdokken",
"FNZD": "Antwerpen-Zuid",
"APD": "Apeldoorn",
"APDM": "Apeldoorn De Maten",
"APDO": "Apeldoorn Osseveld",
"APG": "Appingedam",
"AKL": "Arkel",
"ARN": "Arnemuiden",
"AH": "Arnhem Centraal",
"AHPR": "Arnhem Presikhaaf",
"AHP": "Arnhem Velperpoort",
"AHZ": "Arnhem Zuid",
"ASN": "Assen",
"MA": "Augsburg Hbf",
"AVTGV": "Avignon TGV",
"BRN": "Baarn",
"BH": "Bad Bentheim",
"NSCH": "Bad Nieuweschans",
"OEYNH": "Bad Oeynhausen",
"BADENZ": "Baden (CH)",
"BF": "Baflo",
"BRD": "Barendrecht",
"BNC": "Barneveld Centrum",
"BNN": "Barneveld Noord",
"BNZ": "Barneveld Zuid",
"BASELB": "Basel Bad Bf",
"BASELS": "Basel SBB",
"BDM": "Bedum",
"BK": "Beek-Elsloo",
"BSD": "Beesd",
"BL": "Beilen",
"LLB": "Belsele",
"BGN": "Bergen op Zoom",
"GSB": "Berlin Gesundbrunnen",
"BERHBL": "Berlin Hbf",
"BHF": "Berlin Ostbahnhof",
"BSPD": "Berlin-Spandau",
"BET": "Best",
"FBR": "Beveren",
"BV": "Beverwijk",
"BIELEF": "Bielefeld Hbf",
"BHV": "Bilthoven",
"FIE": "Bilzen",
"BR": "Blerick",
"BLL": "Bloemendaal",
"BDG": "Bodegraven",
"KBOI": "Boisheim",
"ALESS": "Bologna Centrale",
"EBEO": "Bönen",
"BONN": "Bonn Hbf",
"KBB": "Bonn-Beuel",
"FMB": "Boom",
"EBOK": "Bork (Westf)",
"BN": "Borne",
"BSK": "Boskoop",
"BSKS": "Boskoop Snijdelwijk",
"BOURG": "Bourg-St-Maurice",
"BHDV": "Boven-Hardinxveld",
"BKF": "Bovenkarspel Flora",
"BKG": "Bovenkarspel-Grootebroek",
"BMR": "Boxmeer",
"BTL": "Boxtel",
"BD": "Breda",
"BDPB": "Breda-Prinsenbeek",
"BRESSX": "Bressoux",
"BKL": "Breukelen",
"KBRY": "Breyell",
"BMN": "Brummen",
"BRUSC": "Brussel-Centraal",
"BRUSN": "Brussel-Noord",
"BRUSZ": "Brussel-Zuid Midi",
"FBNL": "Brussels Airport-Zaventem",
"BP": "Buitenpost",
"BDE": "Bunde",
"BUENDE": "Bünde (Westf)",
"BNK": "Bunnik",
"BSMZ": "Bussum Zuid",
"CPS": "Capelle Schollevaar",
"CAS": "Castricum",
"CHAMB": "Chambéry",
"CVM": "Chevremont",
"ECMF": "Coesfeld (Westf)",
"CO": "Coevorden",
"COMO": "Como S. Giovanni",
"CK": "Cuijk",
"CL": "Culemborg",
"DA": "Daarlerveen",
"DLN": "Dalen",
"DL": "Dalfsen",
"DVNK": "De Vink",
"DWE": "De Westereen",
"DEI": "Deinum",
"DDN": "Delden",
"DT": "Delft",
"DTCP": "Delft Campus",
"DZ": "Delfzijl",
"DZW": "Delfzijl West",
"DLD": "Den Dolder",
"GVC": "Den Haag Centraal",
"GV": "Den Haag HS",
"LAA": "Den Haag Laan v NOI",
"GVM": "Den Haag Mariahoeve",
"GVMW": "Den Haag Moerwijk",
"YPB": "Den Haag Ypenburg",
"HDR": "Den Helder",
"HDRZ": "Den Helder Zuid",
"DN": "Deurne",
"DV": "Deventer",
"DVC": "Deventer Colmschate",
"DID": "Didam",
"DMN": "Diemen",
"DMNZ": "Diemen Zuid",
"GDP": "Diepenbeek",
"DR": "Dieren",
"DTC": "Doetinchem",
"DTCH": "Doetinchem De Huet",
"DDR": "Dordrecht",
"DDRS": "Dordrecht Stadspolders",
"DDZD": "Dordrecht Zuid",
"EDD": "Dortmund Derne",
"EDO": "Dortmund Hbf",
"EDKD": "Dortmund Kirchderne",
"DB": "Driebergen-Zeist",
"DRH": "Driehuis",
"DRP": "Dronryp",
"DRON": "Dronten",
"DUISB": "Duisburg Hbf",
"DVN": "Duiven",
"DVD": "Duivendrecht",
"KDUL": "Dülken",
"EDULH": "Dülmen",
"KDFFH": "Düsseldorf Flughafen",
"DUSSEL": "Düsseldorf Hbf",
"EC": "Echt",
"EDC": "Ede Centrum",
"ED": "Ede-Wageningen",
"EEM": "Eemshaven",
"EDN": "Eijsden",
"EHV": "Eindhoven Centraal",
"EHS": "Eindhoven Strijp-S",
"LKR": "Ekeren",
"EST": "Elst",
"EMN": "Emmen",
"EMNZ": "Emmen Zuid",
"EM": "Emmerich",
"EL": "Emmerich-Elten",
"EKZ": "Enkhuizen",
"EENP": "Ennepetal",
"ES": "Enschede",
"ESE": "Enschede De Eschmarke",
"ESK": "Enschede Kennispark",
"EEPE": "Epe (Westf)",
"EML": "Ermelo",
"ESN": "Essen",
"ETN": "Etten-Leur",
"EGH": "Eygelshoven",
"EGHM": "Eygelshoven Markt",
"FWD": "Feanwâlden",
"LIVOR": "Firenze Campo di Marte",
"FN": "Franeker",
"FFFM": "Frankfurt (M) Hbf",
"FFS": "Frankfurt (Main) Süd",
"FNAF": "Frankfurt Flughafen Fernb",
"RF": "Freiburg (Breisgau) Hbf",
"GDR": "Gaanderen",
"GDM": "Geldermalsen",
"GP": "Geldrop",
"GLN": "Geleen Oost",
"LUT": "Geleen-Lutterade",
"FGSP": "Gent Sint Pieters",
"GZ": "Gilze-Rijen",
"GBR": "Glanerbrug",
"LGL": "Glons",
"GS": "Goes",
"GO": "Goor",
"TGO": "Göppingen",
"GR": "Gorinchem",
"HOJE": "Göteborg Central",
"GD": "Gouda",
"GDG": "Gouda Goverwelle",
"GBG": "Gramsbergen",
"GK": "Grijpskerk",
"G": "Gronau (Westf.)",
"GN": "Groningen",
"GERP": "Groningen Europapark",
"GNN": "Groningen Noord",
"GW": "Grou-Jirnsum",
"MGZB": "Günzburg",
"HLM": "Haarlem",
"HLMS": "Haarlem Spaarnwoude",
"HAGEN": "Hagen Hbf",
"HWZB": "Halfweg-Zwanenburg",
"HAMM": "Hamm (Westf.)",
"HANN": "Hannover Hbf",
"HDB": "Hardenberg",
"HD": "Harderwijk",
"HBZM": "Hardinxveld Blauwe Zoom",
"GND": "Hardinxveld-Giessendam",
"HRN": "Haren",
"HLG": "Harlingen",
"HLGH": "Harlingen Haven",
"FHS": "Hasselt",
"HK": "Heemskerk",
"HAD": "Heemstede-Aerdenhout",
"HR": "Heerenveen",
"HRY": "Heerenveen IJsstadion",
"HWD": "Heerhugowaard",
"HRL": "Heerlen",
"HRLW": "Heerlen Woonboulevard",
"HZE": "Heeze",
"MID": "Heide (B)",
"HLO": "Heiloo",
"HNO": "Heino",
"HM": "Helmond",
"HMH": "Helmond 't Hout",
"HMBV": "Helmond Brandevoort",
"HMBH": "Helmond Brouwhuis",
"LKM": "Hemiksem",
"HMN": "Hemmen-Dodewaard",
"HGL": "Hengelo",
"HGLG": "Hengelo Gezondheidspark",
"HGLO": "Hengelo Oost",
"LHS": "Herstal",
"HZ": "Herzogenrath",
"HIL": "Hillegom",
"HVS": "Hilversum",
"HVSM": "Hilversum Media Park",
"HVSP": "Hilversum Sportpark",
"HNP": "Hindeloopen",
"FOE": "Hoboken-Polder",
"HB": "Hoensbroek",
"HVL": "Hoevelaken",
"HOR": "Hollandsche Rading",
"HON": "Holten",
"EHZW": "Holzwickede",
"HFD": "Hoofddorp",
"HGV": "Hoogeveen",
"HGZ": "Hoogezand-Sappemeer",
"HKS": "Hoogkarspel",
"HN": "Hoorn",
"HNK": "Hoorn Kersenboogerd",
"HOPF": "Hopfgarten",
"HRT": "Horst-Sevenum",
"HTN": "Houten",
"HTNC": "Houten Castellum",
"SGL": "Houthem-St. Gerlach",
"HDG": "Hurdegaryp",
"IJT": "IJlst",
"INNSB": "Innsbruck Hbf",
"JENBAC": "Jenbach",
"KN": "Kaldenkirchen",
"FKTH": "Kalmthout",
"KPN": "Kampen",
"KPNZ": "Kampen Zuid",
"BZL": "Kapelle-Biezelinge",
"LKP": "Kapellen",
"KARLSR": "Karlsruhe Hbf",
"KRD": "Kerkrade Centrum",
"KTR": "Kesteren",
"GKT": "Kijkuit",
"KBK": "Klarenbeek",
"KMR": "Klimmen-Ransdaal",
"KKO": "Koblenz Hbf",
"KOLN": "Köln Hbf",
"KKD": "Köln Messe/Deutz",
"KKW": "Köln West",
"KKERP": "Köln-Ehrenfeld",
"KKM": "Köln-Mülheim",
"KZ": "Koog aan de Zaan",
"KMW": "Koudum-Molkwerum",
"ODENS": "Københavns Lufthavn St",
"KBD": "Krabbendijke",
"KMA": "Krommenie-Assendelft",
"KW": "Kropswolde",
"KRG": "Kruiningen-Yerseke",
"KUFST": "Kufstein",
"ZLW": "Lage Zwaluwe",
"LG": "Landgraaf",
"LANDRY": "Landry",
"LLZM": "Lansingerland-Zoetermeer",
"LEER": "Leer (Ostfriesl)",
"LDM": "Leerdam",
"LW": "Leeuwarden",
"LWC": "Leeuwarden Camminghaburen",
"ELGD": "Legden",
"LEDN": "Leiden Centraal",
"LDL": "Leiden Lammenschans",
"LLS": "Lelystad Centrum",
"ELET": "Lette (Kr Coesfeld)",
"LEUVEN": "Leuven",
"LTV": "Lichtenvoorde-Groenlo",
"FLJ": "Liège-Carré",
"LUIK": "Liège-Guillemins",
"FLGP": "Liège-Saint-Lambert",
"LSL": "Liers",
"LILLEE": "Lille Europe",
"FLB": "Limburg Süd",
"LINZ": "Linz Hbf",
"LC": "Lochem",
"FLK": "Lokeren",
"STP": "London St. Pancras Int.",
"LP": "Loppersum",
"ELDH": "Lüdinghausen",
"ELUE": "Lünen Hbf",
"LTN": "Lunteren",
"MZ": "Maarheeze",
"MRN": "Maarn",
"MAS": "Maarssen",
"MT": "Maastricht",
"MTN": "Maastricht Noord",
"MTR": "Maastricht Randwyck",
"FMZ": "Mainz Hbf",
"RINGS": "Malmö Central",
"MANNHE": "Mannheim Hbf",
"MG": "Mantgum",
"MRB": "Mariënberg",
"MARNE": "Marne-la-Vallée-Chessy",
"MARS": "Marseille-St-Charles",
"MTH": "Martenshoek",
"MECH": "Mechelen",
"MES": "Meerssen",
"LM": "Melsele",
"MP": "Meppel",
"EMTE": "Metelen Land",
"MDB": "Middelburg",
"DOMOD": "Milano Porta Garibaldi",
"BLTM": "Milmort",
"MINDEN": "Minden (Westf)",
"MCGB": "Mönchengladbach Hbf",
"MMLH": "Mook-Molenhoek",
"MOUT": "Moutiers-Salins-Brides",
"MUNCHH": "München Hbf",
"STRAUB": "München Ost",
"ENHF": "Münster (W) Zentrum Nord",
"MUNST": "Münster (Westf) Hbf",
"ENBE": "Münster-Häger",
"NDB": "Naarden-Bussum",
"NEUSS": "Neuss Hbf",
"LNI": "Niel",
"NA": "Nieuw Amsterdam",
"NVP": "Nieuw Vennep",
"NWK": "Nieuwerkerk a/d IJssel",
"FNU": "Nieuwkerken-Waas",
"NKK": "Nijkerk",
"NM": "Nijmegen",
"NMD": "Nijmegen Dukenburg",
"NMGO": "Nijmegen Goffert",
"NMH": "Nijmegen Heyendaal",
"NML": "Nijmegen Lent",
"NVD": "Nijverdal",
"NDKP": "Noorderkempen",
"ENOW": "Nordwalde",
"NS": "Nunspeet",
"NURNB": "Nürnberg Hbf",
"NH": "Nuth",
"OBD": "Obdam",
"OBERH": "Oberhausen Hbf",
"OBERHS": "Oberhausen-Sterkrade",
"EOP": "Ochtrup",
"RO": "Offenburg",
"OT": "Oisterwijk",
"ODZ": "Oldenzaal",
"OST": "Olst",
"OMN": "Ommen",
"OTB": "Oosterbeek",
"OP": "Opheusden",
"OSNH": "Osnabrück Hbf",
"O": "Oss",
"OW": "Oss West",
"ODB": "Oudenbosch",
"OVN": "Overveen",
"PARIS": "Paris-Nord",
"PASS": "Passau Hbf",
"TP": "Plochingen",
"EPRA": "Praest",
"EPRN": "Preussen",
"PMR": "Purmerend",
"PMO": "Purmerend Overwhere",
"PMW": "Purmerend Weidevenne",
"PT": "Putten",
"FRP": "Puurs",
"RAT": "Raalte",
"RVS": "Ravenstein",
"REGENB": "Regensburg Hbf",
"RV": "Reuver",
"RH": "Rheden",
"RHEINE": "Rheine",
"RHN": "Rhenen",
"RSN": "Rijssen",
"RSW": "Rijswijk",
"RB": "Rilland-Bath",
"RM": "Roermond",
"RD": "Roodeschool",
"RSD": "Roosendaal",
"EHW": "Rosendahl-Holtwick",
"ROSENH": "Rosenheim",
"RS": "Rosmalen",
"RTA": "Rotterdam Alexander",
"RTB": "Rotterdam Blaak",
"RTD": "Rotterdam Centraal",
"RLB": "Rotterdam Lombardijen",
"RTN": "Rotterdam Noord",
"RTST": "Rotterdam Stadion",
"RTZ": "Rotterdam Zuid",
"FSV": "Ruisbroek-Sauvegarde",
"RL": "Ruurlo",
"SCHARD": "Salzburg Hbf",
"SPTN": "Santpoort Noord",
"SPTZ": "Santpoort Zuid",
"SSH": "Sassenheim",
"SWD": "Sauwerd",
"SGN": "Schagen",
"SDA": "Scheemda",
"SCHLL": "Schelle",
"SDM": "Schiedam Centrum",
"SOG": "Schin op Geul",
"SN": "Schinnen",
"SHL": "Schiphol Airport",
"KSWE": "Schwelm",
"ESRT": "Schwerte (Ruhr)",
"ESEM": "Selm",
"ESEB": "Selm-Beifang",
"KSB": "Siegburg/Bonn",
"LSW": "Sinaai",
"MARIA": "Sint-Mariaburg",
"FSN": "Sint-Niklaas",
"STD": "Sittard",
"SDT": "Sliedrecht",
"SDTB": "Sliedrecht Baanhoek",
"SK": "Sneek",
"SKND": "Sneek Noord",
"ST": "Soest",
"STZ": "Soest Zuid",
"SD": "Soestdijk",
"SBK": "Spaubeek",
"POLTEN": "St.Pölten Hbf",
"STV": "Stavoren",
"STM": "Stedum",
"SWK": "Steenwijk",
"EBGO": "Steinfurt-Borghorst",
"EBFT": "Steinfurt-Burgsteinfurt",
"EGRK": "Steinfurt-Grottenkamp",
"LS": "Stendal",
"TS": "Stuttgart Hbf",
"SRN": "Susteren",
"SM": "Swalmen",
"TG": "Tegelen",
"TBG": "Terborg",
"TL": "Tiel",
"TPSW": "Tiel Passewaaij",
"TB": "Tilburg",
"TBR": "Tilburg Reeshof",
"TBU": "Tilburg Universiteit",
"FTG": "Tongeren",
"KT": "Troisdorf",
"TWL": "Twello",
"UTG": "Uitgeest",
"UHZ": "Uithuizen",
"UHM": "Uithuizermeeden",
"TU": "Ulm Hbf",
"EUN": "Unna",
"UST": "Usquert",
"UT": "Utrecht Centraal",
"UTLR": "Utrecht Leidsche Rijn",
"UTLN": "Utrecht Lunetten",
"UTM": "Utrecht Maliebaan",
"UTO": "Utrecht Overvecht",
"UTT": "Utrecht Terwijde",
"UTVR": "Utrecht Vaartsche Rijn",
"UTZL": "Utrecht Zuilen",
"VALTGV": "Valence TGV",
"VK": "Valkenburg",
"VSV": "Varsseveld",
"VDM": "Veendam",
"VNDC": "Veenendaal Centrum",
"VNDW": "Veenendaal West",
"KLP": "Veenendaal-De Klomp",
"VP": "Velp",
"MEREL": "Venezia Santa Lucia",
"VL": "Venlo",
"VRY": "Venray",
"VLB": "Vierlingsbeek",
"VIERS": "Viersen",
"FVS": "Visé",
"VTN": "Vleuten",
"VS": "Vlissingen",
"VSS": "Vlissingen Souburg",
"VDL": "Voerendaal",
"VB": "Voorburg",
"VH": "Voorhout",
"VST": "Voorschoten",
"VEM": "Voorst-Empe",
"VD": "Vorden",
"VZ": "Vriezenveen",
"VHP": "Vroomshoop",
"VG": "Vught",
"WAD": "Waddinxveen",
"WADN": "Waddinxveen Noord",
"WADT": "Waddinxveen Triangel",
"WFM": "Warffum",
"WR": "Weener",
"WT": "Weert",
"WP": "Weesp",
"WL": "Wehl",
"WELS": "Wels Hbf",
"WESEL": "Wesel",
"WTV": "Westervoort",
"WZ": "Wezep",
"WBF": "Wien Hbf",
"WIENH": "Wien Hütteldorf",
"WDN": "Wierden",
"WC": "Wijchen",
"WH": "Wijhe",
"GWD": "Wildert",
"WS": "Winschoten",
"WSM": "Winsum",
"WW": "Winterswijk",
"WWW": "Winterswijk West",
"WD": "Woerden",
"WF": "Wolfheze",
"HWOB": "Wolfsburg Hbf",
"WV": "Wolvega",
"WORGL": "Wörgl",
"WK": "Workum",
"WM": "Wormerveer",
"WUPPH": "Wuppertal Hbf",
"KWBA": "Wuppertal-Barmen",
"KWO": "Wuppertal-Oberbarmen",
"WUPPV": "Wuppertal-Vohwinkel",
"WURZB": "Würzburg Hbf",
"ZD": "Zaandam",
"ZDK": "Zaandam Kogerveld",
"ZZS": "Zaandijk Zaanse Schans",
"ZBM": "Zaltbommel",
"ZVT": "Zandvoort aan Zee",
"ZA": "Zetten-Andelst",
"ZV": "Zevenaar",
"ZVB": "Zevenbergen",
"ZTM": "Zoetermeer",
"ZTMO": "Zoetermeer Oost",
"ZB": "Zuidbroek",
"ZH": "Zuidhorn",
"ZUE": "Zürich HB",
"ZP": "Zutphen",
"ZWD": "Zwijndrecht",
"LZD": "Zwijndrecht (B)",
"ZL": "Zwolle",
"ZLSH": "Zwolle Stadshagen"
}
            </textarea>
            <p class="warning">Let op: Zorg dat dit geldige JSON is. Gebruik dubbele aanhalingstekens voor zowel sleutels als waarden.</p>
        </div>

        <div class="config-section">
            <h3 class="text-xl">Rijrichting Configuratie (JSON):</h3>
            <p class="text-gray-700 mb-2">Definieer richtingen door stationsnamen op te geven die ermee geassocieerd zijn. Als één van de stations in het bericht voorkomt, wordt de bijbehorende richting gesuggereerd.</p>
            <textarea id="directionConfig" rows="8">
{
    "Oost (NL uit)": ["Venlo", "Bad Bentheim", "Emmerich", "Grens Glanerbrug"],
    "West (NL in)": ["Roosendaal", "Vlissingen", "Gronau", "Aachen Hbf"]
}
            </textarea>
            <p class="warning">Let op: Zorg dat dit geldige JSON is. Gebruik dubbele aanhalingstekens voor zowel sleutels als waarden. Stations moeten de volledige (uitgebreide) namen zijn.</p>
        </div>
    </div>

    <script>
        // Functie om de WhatsApp-berichten te verwerken
        function processMessage() {
            const messageInput = document.getElementById('whatsappMessage');
            const outputDiv = document.getElementById('output');
            let message = messageInput.value;

            // 1. Stationsafkortingen omzetten
            let stationMap = {};
            try {
                stationMap = JSON.parse(document.getElementById('stationConfig').value);
            } catch (e) {
                outputDiv.innerHTML = `<p class="warning">Fout bij het parsen van stationsconfiguratie: ${e.message}</p>`;
                return;
            }

            for (const abbreviation in stationMap) {
                if (stationMap.hasOwnProperty(abbreviation)) {
                    // Creëer een regex om alleen hele woorden te matchen (case-insensitive)
                    const regex = new RegExp(`\\b${abbreviation}\\b`, 'gi');
                    message = message.replace(regex, stationMap[abbreviation]);
                }
            }

            // 2. Locnummers en goederentreinbenamingen herkennen
            // Regex voor locnummers: "Loc " gevolgd door cijfers, of losse cijfers die lijken op locnummers (4-6 cijfers, of 3 cijfers spatie 3 cijfers)
            // Deze regex is een schatting en kan valse positieven opleveren.
            const locRegex = /\b(loc\s*\d{3}\s*\d{3}|\b\d{4,6}\b|^\d{4,6}\b|^\d{3}\s\d{3}\b)/gi;
            message = message.replace(locRegex, (match) => `<span class="highlight-loc">${match}</span>`);

            // Regex voor goederentreinbenamingen: Woorden tussen aanhalingstekens (bijv. 'De IJssel'), of specifieke trefwoorden
            // Voeg hier eventueel meer specifieke treinbenamingen toe.
            const trainNameRegex = /(\bTrein\s*'[^']+'\b|\bRailion\s*\d+\b|\bDB Cargo\s*\d+\b|\bSBB Cargo\s*\d+\b)/gi;
            message = message.replace(trainNameRegex, (match) => `<span class="highlight-train">${match}</span>`);

            // Voeg een disclaimer toe voor treininformatie
            let outputHtml = message;
            if (outputHtml.includes('highlight-loc') || outputHtml.includes('highlight-train')) {
                outputHtml += `<p class="warning mt-4"><em>Opmerking: De app kan locnummers en treinbenamingen herkennen en markeren, maar kan geen actuele of gedetailleerde informatie over deze treinen tonen. Deze informatie is vaak niet openbaar beschikbaar.</em></p>`;
            }

            // 3. Rijrichting bepalen
            let directionMap = {};
            try {
                directionMap = JSON.parse(document.getElementById('directionConfig').value);
            } catch (e) {
                outputDiv.innerHTML = `<p class="warning">Fout bij het parsen van rijrichting configuratie: ${e.message}</p>`;
                return;
            }

            let detectedDirections = [];
            for (const direction in directionMap) {
                if (directionMap.hasOwnProperty(direction)) {
                    const associatedStations = directionMap[direction];
                    const foundStationsInDirection = associatedStations.filter(station => {
                        // Controleer of de volledige stationsnaam (na conversie) in het bericht voorkomt
                        return new RegExp(`\\b${station}\\b`, 'i').test(message);
                    });

                    if (foundStationsInDirection.length > 0) {
                        detectedDirections.push({
                            direction: direction,
                            foundStations: foundStationsInDirection
                        });
                    }
                }
            }

            if (detectedDirections.length > 0) {
                outputHtml += `<h3 class="text-xl font-bold mt-6 text-gray-800">Mogelijke Rijrichting(en):</h3>`;
                detectedDirections.forEach(dirInfo => {
                    outputHtml += `<p>• <span class="highlight-direction">${dirInfo.direction}</span> (gebaseerd op het vinden van: ${dirInfo.foundStations.join(', ')})</p>`;
                });
                outputHtml += `<p class="warning mt-2"><em>Opmerking: De rijrichting is een suggestie op basis van de geconfigureerde stations en hun associatie met een richting. Dit is geen absolute bepaling van de daadwerkelijke rijrichting.</em></p>`;
            } else {
                 outputHtml += `<h3 class="text-xl font-bold mt-6 text-gray-800">Rijrichting:</h3>`;
                 outputHtml += `<p>Geen specifieke rijrichting gedetecteerd op basis van de geconfigureerde stations.</p>`;
            }


            outputDiv.innerHTML = outputHtml;
        }

        // Zorg ervoor dat de configuratie textareas de juiste JSON-structuur weergeven
        // bij het laden van de pagina. Dit helpt de gebruiker te zien hoe het eruit moet zien.
        window.onload = function() {
            // Pas de layout aan voor responsiviteit
            const container = document.querySelector('.container');
            if (window.innerWidth < 768) { // Voor mobiele schermen
                container.style.padding = '1.5rem';
                container.style.gap = '1rem';
            }
        };

    </script>
</body>
</html>
